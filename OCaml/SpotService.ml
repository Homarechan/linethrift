(*
 Autogenerated by Thrift Compiler (0.13.0)

 DO NOT EDIT UNLESS YOU ARE SURE YOU KNOW WHAT YOU ARE DOING
*)

open Thrift
open Line_types

(* HELPER FUNCTIONS AND STRUCTURES *)

class lookupByPhoneNumber_args =
object (self)
  val mutable _countryAreaCode : string option = None
  method get_countryAreaCode = _countryAreaCode
  method grab_countryAreaCode = match _countryAreaCode with None->raise (Field_empty "lookupByPhoneNumber_args.countryAreaCode") | Some _x4076 -> _x4076
  method set_countryAreaCode _x4076 = _countryAreaCode <- Some _x4076
  method unset_countryAreaCode = _countryAreaCode <- None
  method reset_countryAreaCode = _countryAreaCode <- None

  val mutable _phoneNumber : string option = None
  method get_phoneNumber = _phoneNumber
  method grab_phoneNumber = match _phoneNumber with None->raise (Field_empty "lookupByPhoneNumber_args.phoneNumber") | Some _x4077 -> _x4077
  method set_phoneNumber _x4077 = _phoneNumber <- Some _x4077
  method unset_phoneNumber = _phoneNumber <- None
  method reset_phoneNumber = _phoneNumber <- None

  method copy =
      let _new = Oo.copy self in
    _new
  method write (oprot : Protocol.t) =
    oprot#writeStructBegin "lookupByPhoneNumber_args";
    (match _countryAreaCode with None -> () | Some _v -> 
      oprot#writeFieldBegin("countryAreaCode",Protocol.T_STRING,2);
      oprot#writeString(_v);
      oprot#writeFieldEnd
    );
    (match _phoneNumber with None -> () | Some _v -> 
      oprot#writeFieldBegin("phoneNumber",Protocol.T_STRING,3);
      oprot#writeString(_v);
      oprot#writeFieldEnd
    );
    oprot#writeFieldStop;
    oprot#writeStructEnd
end
let rec read_lookupByPhoneNumber_args (iprot : Protocol.t) =
  let _str4080 = new lookupByPhoneNumber_args in
    ignore(iprot#readStructBegin);
    (try while true do
        let (_,_t4081,_id4082) = iprot#readFieldBegin in
        if _t4081 = Protocol.T_STOP then
          raise Break
        else ();
        (match _id4082 with 
          | 2 -> (if _t4081 = Protocol.T_STRING then
              _str4080#set_countryAreaCode iprot#readString
            else
              iprot#skip _t4081)
          | 3 -> (if _t4081 = Protocol.T_STRING then
              _str4080#set_phoneNumber iprot#readString
            else
              iprot#skip _t4081)
          | _ -> iprot#skip _t4081);
        iprot#readFieldEnd;
      done; ()
    with Break -> ());
    iprot#readStructEnd;
    _str4080

class lookupByPhoneNumber_result =
object (self)
  val mutable _success : spotPhoneNumberResponse option = None
  method get_success = _success
  method grab_success = match _success with None->raise (Field_empty "lookupByPhoneNumber_result.success") | Some _x4083 -> _x4083
  method set_success _x4083 = _success <- Some _x4083
  method unset_success = _success <- None
  method reset_success = _success <- None

  val mutable _e : talkException option = None
  method get_e = _e
  method grab_e = match _e with None->raise (Field_empty "lookupByPhoneNumber_result.e") | Some _x4084 -> _x4084
  method set_e _x4084 = _e <- Some _x4084
  method unset_e = _e <- None
  method reset_e = _e <- None

  method copy =
      let _new = Oo.copy self in
      if _success <> None then
        _new#set_success self#grab_success#copy;
      if _e <> None then
        _new#set_e self#grab_e#copy;
    _new
  method write (oprot : Protocol.t) =
    oprot#writeStructBegin "lookupByPhoneNumber_result";
    (match _success with None -> () | Some _v -> 
      oprot#writeFieldBegin("success",Protocol.T_STRUCT,0);
      _v#write(oprot);
      oprot#writeFieldEnd
    );
    (match _e with None -> () | Some _v -> 
      oprot#writeFieldBegin("e",Protocol.T_STRUCT,1);
      _v#write(oprot);
      oprot#writeFieldEnd
    );
    oprot#writeFieldStop;
    oprot#writeStructEnd
end
let rec read_lookupByPhoneNumber_result (iprot : Protocol.t) =
  let _str4087 = new lookupByPhoneNumber_result in
    ignore(iprot#readStructBegin);
    (try while true do
        let (_,_t4088,_id4089) = iprot#readFieldBegin in
        if _t4088 = Protocol.T_STOP then
          raise Break
        else ();
        (match _id4089 with 
          | 0 -> (if _t4088 = Protocol.T_STRUCT then
              _str4087#set_success (read_spotPhoneNumberResponse iprot)
            else
              iprot#skip _t4088)
          | 1 -> (if _t4088 = Protocol.T_STRUCT then
              _str4087#set_e (read_talkException iprot)
            else
              iprot#skip _t4088)
          | _ -> iprot#skip _t4088);
        iprot#readFieldEnd;
      done; ()
    with Break -> ());
    iprot#readStructEnd;
    _str4087

class lookupNearby_args =
object (self)
  val mutable _location : location option = None
  method get_location = _location
  method grab_location = match _location with None->raise (Field_empty "lookupNearby_args.location") | Some _x4090 -> _x4090
  method set_location _x4090 = _location <- Some _x4090
  method unset_location = _location <- None
  method reset_location = _location <- None

  val mutable _category : SpotCategory.t option = None
  method get_category = _category
  method grab_category = match _category with None->raise (Field_empty "lookupNearby_args.category") | Some _x4091 -> _x4091
  method set_category _x4091 = _category <- Some _x4091
  method unset_category = _category <- None
  method reset_category = _category <- None

  val mutable _query : string option = None
  method get_query = _query
  method grab_query = match _query with None->raise (Field_empty "lookupNearby_args.query") | Some _x4092 -> _x4092
  method set_query _x4092 = _query <- Some _x4092
  method unset_query = _query <- None
  method reset_query = _query <- None

  val mutable _countryAreaCode : string option = None
  method get_countryAreaCode = _countryAreaCode
  method grab_countryAreaCode = match _countryAreaCode with None->raise (Field_empty "lookupNearby_args.countryAreaCode") | Some _x4093 -> _x4093
  method set_countryAreaCode _x4093 = _countryAreaCode <- Some _x4093
  method unset_countryAreaCode = _countryAreaCode <- None
  method reset_countryAreaCode = _countryAreaCode <- None

  method copy =
      let _new = Oo.copy self in
      if _location <> None then
        _new#set_location self#grab_location#copy;
    _new
  method write (oprot : Protocol.t) =
    oprot#writeStructBegin "lookupNearby_args";
    (match _location with None -> () | Some _v -> 
      oprot#writeFieldBegin("location",Protocol.T_STRUCT,2);
      _v#write(oprot);
      oprot#writeFieldEnd
    );
    (match _category with None -> () | Some _v -> 
      oprot#writeFieldBegin("category",Protocol.T_I32,3);
      oprot#writeI32(SpotCategory.to_i _v);
      oprot#writeFieldEnd
    );
    (match _query with None -> () | Some _v -> 
      oprot#writeFieldBegin("query",Protocol.T_STRING,4);
      oprot#writeString(_v);
      oprot#writeFieldEnd
    );
    (match _countryAreaCode with None -> () | Some _v -> 
      oprot#writeFieldBegin("countryAreaCode",Protocol.T_STRING,5);
      oprot#writeString(_v);
      oprot#writeFieldEnd
    );
    oprot#writeFieldStop;
    oprot#writeStructEnd
end
let rec read_lookupNearby_args (iprot : Protocol.t) =
  let _str4096 = new lookupNearby_args in
    ignore(iprot#readStructBegin);
    (try while true do
        let (_,_t4097,_id4098) = iprot#readFieldBegin in
        if _t4097 = Protocol.T_STOP then
          raise Break
        else ();
        (match _id4098 with 
          | 2 -> (if _t4097 = Protocol.T_STRUCT then
              _str4096#set_location (read_location iprot)
            else
              iprot#skip _t4097)
          | 3 -> (if _t4097 = Protocol.T_I32 then
              _str4096#set_category (SpotCategory.of_i iprot#readI32)
            else
              iprot#skip _t4097)
          | 4 -> (if _t4097 = Protocol.T_STRING then
              _str4096#set_query iprot#readString
            else
              iprot#skip _t4097)
          | 5 -> (if _t4097 = Protocol.T_STRING then
              _str4096#set_countryAreaCode iprot#readString
            else
              iprot#skip _t4097)
          | _ -> iprot#skip _t4097);
        iprot#readFieldEnd;
      done; ()
    with Break -> ());
    iprot#readStructEnd;
    _str4096

class lookupNearby_result =
object (self)
  val mutable _success : spotNearbyResponse option = None
  method get_success = _success
  method grab_success = match _success with None->raise (Field_empty "lookupNearby_result.success") | Some _x4099 -> _x4099
  method set_success _x4099 = _success <- Some _x4099
  method unset_success = _success <- None
  method reset_success = _success <- None

  val mutable _e : talkException option = None
  method get_e = _e
  method grab_e = match _e with None->raise (Field_empty "lookupNearby_result.e") | Some _x4100 -> _x4100
  method set_e _x4100 = _e <- Some _x4100
  method unset_e = _e <- None
  method reset_e = _e <- None

  method copy =
      let _new = Oo.copy self in
      if _success <> None then
        _new#set_success self#grab_success#copy;
      if _e <> None then
        _new#set_e self#grab_e#copy;
    _new
  method write (oprot : Protocol.t) =
    oprot#writeStructBegin "lookupNearby_result";
    (match _success with None -> () | Some _v -> 
      oprot#writeFieldBegin("success",Protocol.T_STRUCT,0);
      _v#write(oprot);
      oprot#writeFieldEnd
    );
    (match _e with None -> () | Some _v -> 
      oprot#writeFieldBegin("e",Protocol.T_STRUCT,1);
      _v#write(oprot);
      oprot#writeFieldEnd
    );
    oprot#writeFieldStop;
    oprot#writeStructEnd
end
let rec read_lookupNearby_result (iprot : Protocol.t) =
  let _str4103 = new lookupNearby_result in
    ignore(iprot#readStructBegin);
    (try while true do
        let (_,_t4104,_id4105) = iprot#readFieldBegin in
        if _t4104 = Protocol.T_STOP then
          raise Break
        else ();
        (match _id4105 with 
          | 0 -> (if _t4104 = Protocol.T_STRUCT then
              _str4103#set_success (read_spotNearbyResponse iprot)
            else
              iprot#skip _t4104)
          | 1 -> (if _t4104 = Protocol.T_STRUCT then
              _str4103#set_e (read_talkException iprot)
            else
              iprot#skip _t4104)
          | _ -> iprot#skip _t4104);
        iprot#readFieldEnd;
      done; ()
    with Break -> ());
    iprot#readStructEnd;
    _str4103

class virtual iface =
object (self)
  method virtual lookupByPhoneNumber : string option -> string option -> spotPhoneNumberResponse
  method virtual lookupNearby : location option -> SpotCategory.t option -> string option -> string option -> spotNearbyResponse
end

class client (iprot : Protocol.t) (oprot : Protocol.t) =
object (self)
  val mutable seqid = 0
  method lookupByPhoneNumber countryAreaCode phoneNumber = 
    self#send_lookupByPhoneNumber countryAreaCode phoneNumber;
    self#recv_lookupByPhoneNumber
  method private send_lookupByPhoneNumber countryAreaCode phoneNumber = 
    oprot#writeMessageBegin ("lookupByPhoneNumber", Protocol.CALL, seqid);
    let args = new lookupByPhoneNumber_args in
      args#set_countryAreaCode countryAreaCode;
      args#set_phoneNumber phoneNumber;
      args#write oprot;
      oprot#writeMessageEnd;
      oprot#getTransport#flush
  method private recv_lookupByPhoneNumber  =
    let (fname, mtype, rseqid) = iprot#readMessageBegin in
      (if mtype = Protocol.EXCEPTION then
        let x = Application_Exn.read iprot in
          (iprot#readMessageEnd;           raise (Application_Exn.E x))
      else ());
      let result = read_lookupByPhoneNumber_result iprot in
        iprot#readMessageEnd;
        match result#get_success with Some v -> v | None -> (
          (match result#get_e with None -> () | Some _v ->
            raise (TalkException _v));
          raise (Application_Exn.E (Application_Exn.create Application_Exn.MISSING_RESULT "lookupByPhoneNumber failed: unknown result")))
  method lookupNearby location category query countryAreaCode = 
    self#send_lookupNearby location category query countryAreaCode;
    self#recv_lookupNearby
  method private send_lookupNearby location category query countryAreaCode = 
    oprot#writeMessageBegin ("lookupNearby", Protocol.CALL, seqid);
    let args = new lookupNearby_args in
      args#set_location location;
      args#set_category category;
      args#set_query query;
      args#set_countryAreaCode countryAreaCode;
      args#write oprot;
      oprot#writeMessageEnd;
      oprot#getTransport#flush
  method private recv_lookupNearby  =
    let (fname, mtype, rseqid) = iprot#readMessageBegin in
      (if mtype = Protocol.EXCEPTION then
        let x = Application_Exn.read iprot in
          (iprot#readMessageEnd;           raise (Application_Exn.E x))
      else ());
      let result = read_lookupNearby_result iprot in
        iprot#readMessageEnd;
        match result#get_success with Some v -> v | None -> (
          (match result#get_e with None -> () | Some _v ->
            raise (TalkException _v));
          raise (Application_Exn.E (Application_Exn.create Application_Exn.MISSING_RESULT "lookupNearby failed: unknown result")))
end

class processor (handler : iface) =
object (self)
  inherit Processor.t

  val processMap = Hashtbl.create 2
  method process iprot oprot =
    let (name, typ, seqid)  = iprot#readMessageBegin in
      if Hashtbl.mem processMap name then
        (Hashtbl.find processMap name) (seqid, iprot, oprot)
      else (
        iprot#skip(Protocol.T_STRUCT);
        iprot#readMessageEnd;
        let x = Application_Exn.create Application_Exn.UNKNOWN_METHOD ("Unknown function "^name) in
          oprot#writeMessageBegin(name, Protocol.EXCEPTION, seqid);
          x#write oprot;
          oprot#writeMessageEnd;
          oprot#getTransport#flush
      );
      true
  method private process_lookupByPhoneNumber (seqid, iprot, oprot) =
    let args = read_lookupByPhoneNumber_args iprot in
      iprot#readMessageEnd;
      let result = new lookupByPhoneNumber_result in
        (try
          result#set_success (handler#lookupByPhoneNumber args#get_countryAreaCode args#get_phoneNumber);
        with
          | TalkException e -> 
              result#set_e e
        );
        oprot#writeMessageBegin ("lookupByPhoneNumber", Protocol.REPLY, seqid);
        result#write oprot;
        oprot#writeMessageEnd;
        oprot#getTransport#flush
  method private process_lookupNearby (seqid, iprot, oprot) =
    let args = read_lookupNearby_args iprot in
      iprot#readMessageEnd;
      let result = new lookupNearby_result in
        (try
          result#set_success (handler#lookupNearby args#get_location args#get_category args#get_query args#get_countryAreaCode);
        with
          | TalkException e -> 
              result#set_e e
        );
        oprot#writeMessageBegin ("lookupNearby", Protocol.REPLY, seqid);
        result#write oprot;
        oprot#writeMessageEnd;
        oprot#getTransport#flush
  initializer
    Hashtbl.add processMap "lookupByPhoneNumber" self#process_lookupByPhoneNumber;
    Hashtbl.add processMap "lookupNearby" self#process_lookupNearby;
end

